# yaml-language-server: $schema=../../recipe.schema.json

gid: f6c7af65-86e0-48c3-80da-08c4605f575c
title: B2B Commerce
summary: Add Business-to-Business (B2B) functionality with company locations,
  quantity rules, and volume pricing
description: |
  This recipe adds comprehensive B2B functionality to your Hydrogen storefront, enabling business customers to:

  - Select their company location for contextualized pricing
  - View and respect quantity rules (minimum, maximum, increment)
  - See volume-based price breaks for bulk purchases
  - Access B2B-specific pricing through contextualized GraphQL queries

  The implementation includes a location selector modal, quantity rule displays on product pages, 
  and cart functionality that respects B2B quantity rules. All product queries are contextualized 
  with buyer information (company location + customer token) to ensure accurate B2B pricing.
notes:
  - For production, all product queries should be contextualized with buyer
    information
requirements: |
  - Shopify Plus plan with B2B enabled
  - New customer accounts activated
  - At least one B2B company with customer access configured
  - Products with quantity rules or volume pricing configured (optional but recommended for testing)
ingredients:
  - path: templates/skeleton/app/components/B2BLocationProvider.tsx
    description: null
  - path: templates/skeleton/app/components/B2BLocationSelector.tsx
    description: null
  - path: templates/skeleton/app/components/PriceBreaks.tsx
    description: null
  - path: templates/skeleton/app/components/QuantityRules.tsx
    description: null
  - path: templates/skeleton/app/graphql/customer-account/CustomerLocationsQuery.ts
    description: null
  - path: templates/skeleton/app/routes/b2blocations.tsx
    description: null
deletedFiles: []
steps:
  - type: PATCH
    step: "1"
    name: Document B2B features, requirements, and implementation details in the
      project README
    description: null
    diffs:
      - file: README.md
        patchFile: README.md.db10ed.patch
  - type: NEW_FILE
    step: "2"
    name: Create a React context provider to manage company location state across
      the app
    description: null
    ingredients:
      - path: templates/skeleton/app/components/B2BLocationProvider.tsx
  - type: PATCH
    step: "3"
    name: Update quantity controls to respect B2B minimum, maximum, and increment
      rules
    description: null
    diffs:
      - file: app/components/CartLineItem.tsx
        patchFile: CartLineItem.tsx.2c9a50.patch
  - type: NEW_FILE
    step: "4"
    name: Build a modal that lets customers choose which company location to use for
      pricing
    description: null
    ingredients:
      - path: templates/skeleton/app/components/B2BLocationSelector.tsx
  - type: PATCH
    step: "5"
    name: Add a location selector button to the header for switching between company
      locations
    description: null
    diffs:
      - file: app/components/Header.tsx
        patchFile: Header.tsx.e25645.patch
  - type: NEW_FILE
    step: "6"
    name: Display volume pricing tiers that show bulk purchase discounts
    description: null
    ingredients:
      - path: templates/skeleton/app/components/PriceBreaks.tsx
  - type: PATCH
    step: "7"
    name: Accept quantity parameter to support B2B minimum quantity and increment
      rules
    description: null
    diffs:
      - file: app/components/ProductForm.tsx
        patchFile: ProductForm.tsx.649d3b.patch
  - type: NEW_FILE
    step: "8"
    name: Show minimum, maximum, and increment quantity requirements for B2B products
    description: null
    ingredients:
      - path: templates/skeleton/app/components/QuantityRules.tsx
  - type: PATCH
    step: "9"
    name: Add quantity rules and price breaks to cart GraphQL fragments
    description: null
    diffs:
      - file: app/lib/fragments.ts
        patchFile: fragments.ts.026109.patch
  - type: NEW_FILE
    step: "10"
    name: Query company locations from the Customer Account API for B2B customers
    description: null
    ingredients:
      - path: templates/skeleton/app/graphql/customer-account/CustomerLocationsQuery.ts
  - type: PATCH
    step: "11"
    name: Wrap the app with B2B location provider and add company location types
    description: null
    diffs:
      - file: app/root.tsx
        patchFile: root.tsx.5e9998.patch
  - type: NEW_FILE
    step: "12"
    name: Handle location selection and automatically set location if customer has
      only one
    description: null
    ingredients:
      - path: templates/skeleton/app/routes/b2blocations.tsx
  - type: PATCH
    step: "13"
    name: Clear company location and customer data from cart when logging out
    description: null
    diffs:
      - file: app/routes/account_.logout.tsx
        patchFile: account_.logout.tsx.a1f12e.patch
  - type: PATCH
    step: "14"
    name: Contextualize product queries with buyer information and display B2B
      pricing details
    description: null
    diffs:
      - file: app/routes/products.$handle.tsx
        patchFile: products.$handle.tsx.6f2e82.patch
nextSteps: null
llms:
  userQueries: []
  troubleshooting: []
commit: 0511444a026f5b80c3927fbc2e31b1ab827cfeae
