# yaml-language-server: $schema=../../recipe.schema.json

title: Subscriptions
image: null
description: |
  This recipe adds subscription capabilities to your Hydrogen storefront by implementing [selling plan groups](https://shopify.dev/docs/api/storefront/latest/objects/SellingPlanGroup) and options. Customers can choose between one-time purchases or recurring subscriptions when available.

  The implementation:
  1. Modifies product detail pages to display subscription options with accurate pricing
  2. Adds a SellingPlanSelector component that presents available subscription options
  3. Enhances GraphQL fragments to fetch all necessary selling plan data
  4. Displays subscription details on applicable cart line items
  With this recipe, merchants can offer flexible purchasing options while maintaining a seamless customer experience.
notes: []
deletedFiles: []
ingredients:
  - path: templates/skeleton/app/components/SellingPlanSelector.tsx
    description: null
  - path: templates/skeleton/app/styles/selling-plan.css
    description: null
steps:
  - type: INFO
    name: Requirements
    description: >
      This recipe comes pre-configured for our demo storefront using an example
      subscription product with the handle `shopify-wax`.

      #### Setting Up in Your Own Store

      To implement subscriptions in your store:

      1. Install a [Shopify
      Subscriptions](https://apps.shopify.com/shopify-subscriptions) app

      2. Use the app to create selling plans for your products

      3. Assign these selling plans to any products you want to offer as
      subscriptions
  - type: COPY_INGREDIENTS
    name: Copy ingredients
    description: Copy the ingredients from the template directory to the current directory.
    ingredients:
      - templates/skeleton/app/components/SellingPlanSelector.tsx
      - templates/skeleton/app/styles/selling-plan.css
  - type: PATCH
    name: Render the selling plan in the cart
    description: >
      Updates CartLineItem to show subscription information when available. Extracts sellingPlanAllocation
      from cart line data and displays the plan name. Also standardizes component import paths.
    diffs:
      - file: app/components/CartLineItem.tsx
        patchFile: CartLineItem.tsx.f93ff4.patch
  - type: PATCH
    name: app/components/ProductForm.tsx
    description: >
      Enhances ProductForm to support subscription functionality. Adds conditional rendering to
      display either subscription options or standard variant selectors. Implements SellingPlanSelector and
      SellingPlanGroup components to handle subscription plan selection. Updates AddToCartButton to include
      selling plan data when subscriptions are selected.
    diffs:
      - file: app/components/ProductForm.tsx
        patchFile: ProductForm.tsx.252e88.patch
  - type: PATCH
    name: app/components/ProductPrice.tsx
    description: >
      Enhances ProductPrice component to display subscription pricing. Adds SellingPlanPrice function that
      calculates adjusted prices based on subscription plan type (fixed amount, fixed price, or percentage).
      Handles different price adjustment types and renders the appropriate subscription price when a selling plan is selected.
    diffs:
      - file: app/components/ProductPrice.tsx
        patchFile: ProductPrice.tsx.49f564.patch
  - type: PATCH
    name: Add Selling Plan Data to Cart Queries
    description: >
      Adds `sellingPlanAllocation` field with plan name to both standard and componentizable cart line GraphQL fragments,
      enabling subscription details display in cart.
    diffs:
      - file: app/lib/fragments.ts
        patchFile: fragments.ts.18726b.patch
  - type: PATCH
    name: Add SellingPlanSelector to product pages
    description: >
      Adds SellingPlanSelector component to display subscription options on
      product pages. Handles pricing adjustments, maintains selection state via
      URL parameters, and updates add-to-cart functionality. Fetches
      subscription data through the updated cart GraphQL fragments.
    diffs:
      - file: app/routes/products.$handle.tsx
        patchFile: products.$handle.tsx.7addea.patch
commit: cd76a0df1a585b9e3f6e615bc2cb67c39a3e7a76
